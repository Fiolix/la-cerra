<h2>Somewhere</h2>

<!-- Summary -->
<section class="summary">
  <h3>Summary</h3>
  <p>Somewhere is the closest sector if you are staying at La Cerra. In fact, the boulders are located within 5 minutes walking distance from the campsite - perfect to work on some projects before breakfast or a late ascent after dinner. The boulders are mostly of low to moderate height and offer ideal drop zones. You will find rather easier problems up to Fb 6b but some harder projects on Big Piggy are still waiting to be checked off. In combination with the close proximity to the campsite, Somewhere represents an ideal sector for families with smaller children or beginners, and is perfect to get used to the rough granite on your first day at La Cerra. As an added advantage, the farm dogs will probably enjoy this sector along with you.</p>
</section>

<!-- Karte -->
<section class="map">
  <img src="/la-cerra/img/bouldering/la-cerra/somewhere/somewhere_map.png" alt="Karte des Sektors Somewhere" />
</section>

<!-- Dropdown zur Blocknavigation -->
<nav class="block-nav" style="margin: 1rem 0; text-align: center;">
  <label for="block-select">Jump to block:</label>
  <select id="block-select" style="margin-left: 0.5rem; padding: 0.3rem;">
    <option value="#">-- Select a block --</option>
  </select>
</nav>

<!-- Dynamischer Boulderblock-Container -->
<section id="boulder-blocks"></section>

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

  const supabaseUrl = 'https://ymeumqnmcumgqlffwwjb.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InltZXVtcW5tY3VtZ3FsZmZ3d2piIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwNTAyMTEsImV4cCI6MjA2NjYyNjIxMX0.wOCjVUegJsBS8t11yXkgrN-I41wJlOreJ3feUtVaMxs';
  const supabase = createClient(supabaseUrl, supabaseKey);

  async function loadBlocks() {
    const { data: blocks, error: blockError } = await supabase.from('blocks').select('*').eq('sektor', 'somewhere').order('nummer');
    const { data: routes, error: routeError } = await supabase.from('routes').select('*');

    if (blockError) {
      console.error('Fehler beim Laden der BlÃ¶cke:', blockError);
      return;
    }
    if (routeError) {
      console.error('Fehler beim Laden der Routen:', routeError);
      return;
    }

    const container = document.getElementById('boulder-blocks');
    const dropdown = document.getElementById('block-select');
    container.innerHTML = '';

    blocks.forEach(block => {
      const blockRoutes = routes.filter(r => r.block_id === block.id);
      const blockDiv = document.createElement('section');
      blockDiv.className = 'boulder-block';
      blockDiv.id = `block-${block.nummer}`;
      blockDiv.style.marginTop = '2rem';

      blockDiv.innerHTML = `
        <div class="block-header" style="display: flex; justify-content: space-between; align-items: baseline; font-variant: small-caps; font-weight: bold; font-size: 1.1rem; border-bottom: 1px solid #ccc; padding-bottom: 0.5rem;">
          <span class="block-id">${block.nummer}</span>
          <span class="block-name">${block.name}</span>
          <span class="block-height" style="font-weight: normal; font-size: 0.9rem;">Height: ${block.hoehe ?? ''}</span>
        </div>
        <img src="/img/bouldering/${block.sektor}/${block.bild}" alt="Blockbild" style="margin: 1rem 0; max-width: 100%; height: auto;" />
        ${blockRoutes.map(route => `
          <div class="route" style="margin-bottom: 1rem;">
            <p style="display: flex; justify-content: space-between; font-weight: bold;">
              <span style="min-width: 2rem;">${route.buchstabe}</span>
              <span class="route-name">${route.name ?? ''}</span>
              <span>${route.grad}</span>
            </p>
            ${route.beschreibung ? `<p><em>${route.beschreibung}</em></p>` : ''}
          </div>`).join('')}
      `;

      container.appendChild(blockDiv);

      // Dropdown-Eintrag erzeugen
      const option = document.createElement('option');
      option.value = `#block-${block.nummer}`;
      option.textContent = `${block.nummer} ${block.name}`;
      dropdown.appendChild(option);
    });

    // Sprung beim Wechsel im Dropdown
    dropdown.addEventListener('change', (e) => {
      const target = e.target.value;
      if (target !== '#') {
        document.querySelector(target)?.scrollIntoView({ behavior: 'smooth' });
      }
    });
  }

  loadBlocks();
</script>
